"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});class h{constructor(t,o){this.obj=t,this.key=o,this._callHandlers=[],this._returnHandlers=[],this._errorHandlers=[],this._origFn=t[o],this._hook()}_hook(){const t=this;this.obj[this.key]=function(...o){t._callHandlers.forEach(e=>e.call(this,o));let r;try{r=t._origFn.apply(this,o)}catch(e){throw t._errorHandlers.forEach(s=>s.call(this,e)),e}return r&&typeof r.then=="function"?r.then(e=>(t._returnHandlers.forEach(s=>s.call(this,e)),e),e=>(t._errorHandlers.forEach(s=>s.call(this,e)),Promise.reject(e))):(t._returnHandlers.forEach(e=>e.call(this,r)),r)}}onCall(t){return this._callHandlers.push(t),this}onReturn(t){return this._returnHandlers.push(t),this}onError(t){return this._errorHandlers.push(t),this}unhook(){this.obj[this.key]=this._origFn}}class l{constructor(t,o){this.obj=t,this.key=o,this._getHandlers=[],this._setHandlers=[],this._origDescriptor=Object.getOwnPropertyDescriptor(t,o),this._value=t[o],this._hook()}_hook(){const t=this;Object.defineProperty(this.obj,this.key,{configurable:!0,enumerable:!0,get(){return t._getHandlers.forEach(o=>o.call(this,t._value)),t._value},set(o){t._setHandlers.forEach(r=>r.call(this,o)),t._value=o}})}onGet(t){return this._getHandlers.push(t),this}onSet(t){return this._setHandlers.push(t),this}unhook(){this._origDescriptor&&Object.defineProperty(this.obj,this.key,this._origDescriptor)}}function c(n,t){const o=t.split(".");let r=n;for(let s=0;s<o.length-1;s++){if(!r)return null;r=r[o[s]]}const e=o[o.length-1];return r?{obj:r,key:e}:null}class u{constructor(t=typeof window<"u"?window:globalThis){this.root=t,this.hooks=new Map}hook(t){const o=c(this.root,t);if(!o)throw new Error(`Invalid path: ${t}`);const{obj:r,key:e}=o,s=Object.getOwnPropertyDescriptor(r,e),i=typeof r[e]=="function"&&!(s&&(s.get||s.set))?new h(r,e):new l(r,e);return this.hooks.set(t,i),i}unhook(t){const o=this.hooks.get(t);o&&(o.unhook(),this.hooks.delete(t))}unhookAll(){for(const t of this.hooks.values())t.unhook();this.hooks.clear()}}exports.FunctionHook=h;exports.HookManager=u;exports.PropertyHook=l;
